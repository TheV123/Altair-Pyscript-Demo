<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css"/>
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>

    <title>Pyscript & Altair</title>
    <py-env>
- altair
- pandas
- vega_datasets
    </py-env>
</head>
<body>
    <h1 style="font-size:3em">Exploring IMDB Movies dataset with Pyscript</h1>
    <div id="dashboard"></div>
    <py-script output = "dashboard">
import altair as alt
from vega_datasets import data

df = data.movies.url
brush = alt.selection_interval()

rect = alt.Chart(df).mark_bar().encode(
    alt.X('IMDB_Rating:Q', bin = True),
    alt.Y('Rotten_Tomatoes_Rating:Q', bin=True),
    color = alt.condition(brush, "Rotten_Tomatoes_Rating:Q", alt.value("lightgray"))
).add_selection(
    brush
)

text = alt.Chart(df).mark_text().encode(
    y=alt.Y('row_number:O', axis=None),
).transform_window(
    row_number='row_number()'
).transform_filter(
    brush
).transform_window(
    rank='rank(row_number)'
).transform_filter(
    alt.datum.rank < 20
)

ratings = text.encode(
    text = 'Rotten_Tomatoes_Rating:Q'

)
moviename = text.encode(
    text = "Title:N"
)

rect | ratings | moviename
    </py-script>
</body>
</html>